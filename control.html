<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>3PT Control (3-ball racks + 2 logo)</title>
<style>
  body{background:#111;color:white;font-family:Arial;padding:30px;}
  button{padding:10px 18px;margin:6px;border:none;border-radius:8px;cursor:pointer;font-weight:bold;}
  .make{background:#22c55e;}
  .miss{background:#ef4444;color:white;}
  .start{background:#2563eb;color:white;}
  .pause{background:#aaa;color:black;}
  .reset{background:#ddd;color:black;}
  input{padding:6px;margin:6px 0;font-size:16px;}
  label{opacity:.8;font-size:12px;text-transform:uppercase;letter-spacing:.5px;}
  .timer{font-size:24px;margin-top:15px;}
  .meta{opacity:.7;margin-top:10px;}
</style>
</head>
<body>

<h2>3PT Control</h2>

<label>Player Name</label><br>
<input id="player" placeholder="Player Name"><br>

<label>Round Time (seconds)</label><br>
<input type="number" id="roundTime" value="70" min="1"><br>

<br>

<button class="start" onclick="start()">Start</button>
<button class="pause" onclick="pause()">Pause</button>
<button class="reset" onclick="resetRound()">Reset</button>

<br><br>

<button class="make" onclick="shot('made')">MAKE</button>
<button class="miss" onclick="shot('miss')">MISS</button>

<div class="timer" id="timerDisplay">70.0</div>
<div class="meta" id="stepInfo">Section: 1/7 • Ball: 1</div>

<script>
  const SECTIONS = [
    { type:"rack", label:"CORNER", balls:3 },
    { type:"rack", label:"WING",   balls:3 },
    { type:"logo", label:"LOGO",   balls:1 },
    { type:"rack", label:"TOP KEY",balls:3 },
    { type:"logo", label:"LOGO",   balls:1 },
    { type:"rack", label:"WING",   balls:3 },
    { type:"rack", label:"CORNER", balls:3 },
  ];

  function defaultState(){
    return {
      player:"PLAYER",
      score:0,
      timeLeft:70000,
      roundTime:70000,
      running:false,
      sectionIndex:0,
      ballIndex:0,
      shots: SECTIONS.map(s => Array.from({length:s.balls}, ()=> null))
    };
  }

  function getState(){
    return JSON.parse(localStorage.getItem("threePTStateV2")) || defaultState();
  }

  function setState(s){
    localStorage.setItem("threePTStateV2", JSON.stringify(s));
  }

  // scoring
  function pointsFor(sectionIndex, ballIndex){
    const meta = SECTIONS[sectionIndex];
    if(meta.type === "logo") return 3;
    // rack: ball 3 (index 2) = 2 points, others = 1
    return (ballIndex === 2) ? 2 : 1;
  }

  document.getElementById("player").addEventListener("input", ()=>{
    const s = getState();
    s.player = document.getElementById("player").value || "PLAYER";
    setState(s);
  });

  document.getElementById("roundTime").addEventListener("change", ()=>{
    const s = getState();
    const secs = Math.max(1, parseInt(document.getElementById("roundTime").value || "70", 10));
    s.roundTime = secs * 1000;
    s.timeLeft  = s.roundTime;
    setState(s);
  });

  function start(){
    const s=getState();
    s.running=true;
    setState(s);
  }
  function pause(){
    const s=getState();
    s.running=false;
    setState(s);
  }

  function resetRound(){
    const s = defaultState();
    const secs = Math.max(1, parseInt(document.getElementById("roundTime").value || "70", 10));
    s.roundTime = secs * 1000;
    s.timeLeft  = s.roundTime;
    s.player = document.getElementById("player").value || "PLAYER";
    setState(s);
  }

  function advance(s){
    const meta = SECTIONS[s.sectionIndex];
    s.ballIndex++;

    if(s.ballIndex >= meta.balls){
      s.ballIndex = 0;
      s.sectionIndex++;
      if(s.sectionIndex >= SECTIONS.length){
        // end
        s.sectionIndex = SECTIONS.length - 1;
        s.ballIndex = SECTIONS[SECTIONS.length - 1].balls - 1;
        s.running = false;
      }
    }
  }

  function shot(result){
    const s = getState();
    if(s.timeLeft <= 0) return;

    const sec = s.sectionIndex;
    const ball = s.ballIndex;

    // prevent overwriting
    if(s.shots?.[sec]?.[ball] != null) return;

    s.shots[sec][ball] = result;

    if(result === "made"){
      s.score += pointsFor(sec, ball);
    }

    advance(s);
    setState(s);
  }

  // UI updates
  setInterval(()=>{
    const s=getState();
    document.getElementById("timerDisplay").textContent = (s.timeLeft/1000).toFixed(1);
    document.getElementById("stepInfo").textContent =
      `Section: ${s.sectionIndex+1}/7 • Ball: ${s.ballIndex+1}`;
  }, 100);
</script>
</body>
</html>
