<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>3PT Control</title>
<style>
body{background:#111;color:white;font-family:Arial;padding:30px;}
button{padding:10px 18px;margin:6px;border:none;border-radius:8px;cursor:pointer;font-weight:bold;}
.make{background:#22c55e;}
.make2{background:gold;color:black;}
.miss{background:#ef4444;}
.start{background:#2563eb;color:white;}
.pause{background:#aaa;}
.reset{background:#ddd;}
input,select{padding:6px;margin:6px 0;}
.timer{font-size:24px;margin-top:15px;}
</style>
</head>
<body>

<h2>3PT Control</h2>

<input id="player" placeholder="Player Name"><br>

<label>Round Time (seconds)</label><br>
<input type="number" id="roundTime" value="70"><br>

<label>Money Rack</label><br>
<select id="moneyRack">
<option value="0">Rack 1</option>
<option value="1">Rack 2</option>
<option value="2" selected>Rack 3</option>
<option value="3">Rack 4</option>
<option value="4">Rack 5</option>
</select>

<br><br>

<button class="start" onclick="start()">Start</button>
<button class="pause" onclick="pause()">Pause</button>
<button class="reset" onclick="resetRound()">Reset</button>

<br><br>

<button class="make" onclick="shot('made')">MAKE</button>
<button class="make2" onclick="shot('made',2)">MAKE +2</button>
<button class="miss" onclick="shot('miss')">MISS</button>

<div class="timer" id="timerDisplay">70.0</div>

<script>
const API="https://jsonblob.com/api/jsonBlob/019c542f-f9ad-731c-addd-a35c2ca9abd9";

async function getState(){
let r=await fetch(API);
return await r.json();
}

async function saveState(s){
await fetch(API,{
method:"PUT",
headers:{"Content-Type":"application/json"},
body:JSON.stringify(s)
});
}

document.getElementById("player").addEventListener("input",async function(){
let s=await getState();
s.player=this.value;
await saveState(s);
});

document.getElementById("roundTime").addEventListener("change",async function(){
let s=await getState();
s.roundTime=parseInt(this.value)*1000;
s.timeLeft=s.roundTime;
await saveState(s);
});

document.getElementById("moneyRack").addEventListener("change",async function(){
let s=await getState();
s.moneyRack=parseInt(this.value);
await saveState(s);
});

async function start(){
let s=await getState();
s.running=true;
await saveState(s);
}

async function pause(){
let s=await getState();
s.running=false;
await saveState(s);
}

async function resetRound(){
let s=await getState();
s.score=0;
s.timeLeft=s.roundTime;
s.running=false;
s.rackIndex=0;
s.ballIndex=0;
s.balls=Array.from({length:5},()=>Array.from({length:5},()=>null));
await saveState(s);
}

async function shot(type,force=null){
let s=await getState();
let r=s.rackIndex,b=s.ballIndex;
if(r>4)return;
if(s.balls[r][b]!=null)return;

s.balls[r][b]=type;

if(type==="made"){
let pts=force!=null?force:(r===s.moneyRack||b===4?2:1);
s.score+=pts;
}

s.ballIndex++;
if(s.ballIndex>4){
s.ballIndex=0;
s.rackIndex++;
}

await saveState(s);
}

setInterval(async ()=>{
let s=await getState();
if(s.running && s.timeLeft>0){
s.timeLeft-=100;
if(s.timeLeft<0)s.timeLeft=0;
await saveState(s);
}
document.getElementById("timerDisplay").textContent=(s.timeLeft/1000).toFixed(1);
},100);

</script>
</body>
</html>
