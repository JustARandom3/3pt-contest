<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>3PT Overlay</title>

<style>
body{
  margin:0;
  background:transparent;
  font-family:Arial, Helvetica, sans-serif;
}

#wrap{
  position:absolute;
  bottom:40px;
  left:40px;
  background:linear-gradient(145deg,#0f0f0f,#1a1a1a);
  padding:20px 24px;
  border-radius:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.5);
  display:inline-block;
  overflow:hidden;
  transition:width .4s ease;
}

/* top info */
.top{
  display:flex;
  gap:16px;
  margin-bottom:18px;
}

.box{
  background:#1b1b1b;
  padding:10px 14px;
  border-radius:10px;
  min-width:80px;
}

.label{
  font-size:10px;
  color:#888;
  letter-spacing:1px;
}

.value{
  font-size:20px;
  font-weight:bold;
  color:#fff;
}

/* racks row */
.racks{
  display:flex;
  gap:18px;
}

.rack{
  background:#1a1a1a;
  padding:10px 14px;
  border-radius:12px;
  min-width:150px;
  transition:all .3s ease;
}

.rack.active{
  border:2px solid #ffd400;
}

.rack-title{
  font-size:11px;
  color:#aaa;
  margin-bottom:6px;
}

.balls{
  display:flex;
  gap:8px;
}

.ball{
  width:14px;
  height:14px;
  border-radius:50%;
  background:#333;
}

.ball.made{ background:#27d06c; }
.ball.miss{ background:#ff3b3b; }
.ball.money{
  border:2px solid #ffd400;
}
</style>
</head>

<body>
<div id="wrap">
  <div class="top">
    <div class="box">
      <div class="label">SHOOTER</div>
      <div class="value" id="player">PLAYER</div>
    </div>
    <div class="box">
      <div class="label">SCORE</div>
      <div class="value" id="score">0</div>
    </div>
    <div class="box">
      <div class="label">TIME</div>
      <div class="value" id="time">60.0</div>
    </div>
  </div>

  <div class="racks" id="racks"></div>
</div>

<script>

const RACK_NAMES = ["CORNER","WING","TOP KEY","WING","CORNER"];
const STATE_URL = "state.json"; // IMPORTANT

function createRack(name){
  const rack = document.createElement("div");
  rack.className="rack";

  const title=document.createElement("div");
  title.className="rack-title";
  title.innerText=name;

  const balls=document.createElement("div");
  balls.className="balls";

  for(let i=0;i<5;i++){
    const ball=document.createElement("div");
    ball.className="ball";
    balls.appendChild(ball);
  }

  rack.appendChild(title);
  rack.appendChild(balls);
  return rack;
}

async function fetchState(){
  try{
    const res=await fetch(STATE_URL+"?t="+Date.now());
    return await res.json();
  }catch(e){
    return null;
  }
}

function render(state){

  if(!state) return;

  document.getElementById("player").innerText=state.player;
  document.getElementById("score").innerText=state.score;

  let seconds=(state.timeLeftMs||60000)/1000;
  document.getElementById("time").innerText=seconds.toFixed(1);

  const racksEl=document.getElementById("racks");
  racksEl.innerHTML="";

  for(let r=0;r<=state.rackIndex;r++){
    const rack=createRack(RACK_NAMES[r]);

    if(r===state.rackIndex) rack.classList.add("active");

    const balls=rack.querySelectorAll(".ball");

    for(let b=0;b<5;b++){
      if(r===state.moneyRack){
        balls[b].classList.add("money");
      }

      let shot=state.balls?.[r]?.[b];

      if(shot==="made") balls[b].classList.add("made");
      if(shot==="miss") balls[b].classList.add("miss");
    }

    racksEl.appendChild(rack);
  }

  // ðŸ”¥ AUTO SIZE WIDTH (NO GUESSING)
  let wrap=document.getElementById("wrap");
  let racks=document.querySelectorAll(".rack");
  let last=racks[state.rackIndex];

  if(last){
    let rightEdge=last.offsetLeft+last.offsetWidth;
    wrap.style.width=(rightEdge+40)+"px";
  }
}

async function loop(){
  const state=await fetchState();
  render(state);
}

setInterval(loop,300);
loop();

</script>
</body>
</html>
